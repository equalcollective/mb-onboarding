# Sponsored Products Budget Report Schema

report_type: "sponsored_products_budget"
display_name: "Sponsored Products Budget Report"
description: "Amazon Sponsored Products Budget report with budget performance and recommendations"
allow_extra_columns: false  # Strict validation - no extra columns allowed

# Temporal configuration - defines how time periods are handled
temporal_config:
  model: "row"
  granularity_field: "period_granularity"
  supported_granularities: ["daily"]
  row_date_field: "record_date"

# Uniqueness definition - defines what makes a row unique for upsert operations
uniqueness_keys:
  - "seller_id"           # Metadata column
  - "marketplace"         # Metadata column
  - "record_date"         # Report column
  - "portfolio_name"      # Report column
  - "campaign_name"       # Report column

# Metadata fields that can be provided with the report
metadata_schema:
  required:
    - name: "report_date"
      data_type: "date"
      validation: "valid_date"
      description: "The date for which this report was generated"

    - name: "marketplace"
      data_type: "string"
      validation: "marketplace_enum"
      description: "The marketplace for this report (US or UK)"

    - name: "seller_id"
      data_type: "string"
      validation: "non_empty"
      description: "The seller ID for this report"

    - name: "period_granularity"
      data_type: "string"
      validation: "enum"
      allowed_values: ["daily"]
      default: "daily"
      description: "Time granularity - always 'daily' for Sponsored Products"

# Upload validation checks - validates CSV content against existing data
upload_validation_checks:
  enabled: true
  applies_from_upload: 2  # Skip validation for first upload (no data to compare)

  intersection_checks:
    - column: "campaign_name"
      min_intersection_percent: 30
      check_type: "set_intersection"
      scope: "seller_marketplace"
      description: "Campaign names must have 30% overlap with existing data (campaigns change frequently)"

# All columns are required from Amazon's Sponsored Products Budget Report
required_columns:
  # Date Information
  - aliases:
      - "Date"
    db_column: "record_date"
    data_type: "date"
    validation: "valid_date"
    description: "Report date"

  - aliases:
      - "Start Date"
    db_column: "start_date"
    data_type: "date"
    validation: "allow_null"
    required: false
    description: "Campaign start date"

  - aliases:
      - "End Date"
    db_column: "end_date"
    data_type: "date"
    validation: "allow_null"
    required: false
    description: "Campaign end date"

  # Campaign Information
  - aliases:
      - "Portfolio name"
    db_column: "portfolio_name"
    data_type: "string"
    validation: "allow_empty"
    description: "Portfolio name for the campaign"

  - aliases:
      - "Program Type"
    db_column: "program_type"
    data_type: "string"
    validation: "non_empty"
    description: "Program type (Sponsored Products)"

  - aliases:
      - "Campaign Name"
    db_column: "campaign_name"
    data_type: "string"
    validation: "non_empty"
    description: "Advertising campaign name"

  - aliases:
      - "Country"
    db_column: "country"
    data_type: "string"
    validation: "allow_empty"
    required: false
    description: "Country where ad was shown"

  - aliases:
      - "Status"
    db_column: "status"
    data_type: "string"
    validation: "non_empty"
    description: "Campaign status (ENABLED, PAUSED, etc.)"

  - aliases:
      - "Currency"
    db_column: "currency"
    data_type: "string"
    validation: "non_empty"
    description: "Currency code (USD, EUR, etc.)"

  # Budget Information
  - aliases:
      - "Budget Amount"
    db_column: "budget_amount"
    data_type: "currency"
    validation: "non_negative"
    description: "Daily budget amount"

  - aliases:
      - "Recommended Budget"
    db_column: "recommended_budget"
    data_type: "currency"
    validation: "allow_null"
    description: "Amazon's recommended budget"

  - aliases:
      - "Average Time in Budget"
    db_column: "average_time_in_budget"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of time budget was active"

  # Campaign Settings
  - aliases:
      - "Targeting Type"
    db_column: "targeting_type"
    data_type: "string"
    validation: "non_empty"
    description: "Targeting type (Automatic targeting, Manual targeting)"

  - aliases:
      - "Bidding strategy"
    db_column: "bidding_strategy"
    data_type: "string"
    validation: "non_empty"
    description: "Bidding strategy (Dynamic bids - up and down, etc.)"

  # Performance Metrics
  - aliases:
      - "Impressions"
    db_column: "impressions"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of times ad was displayed"

  - aliases:
      - "Last Year Impressions"
    db_column: "last_year_impressions"
    data_type: "integer"
    validation: "allow_null"
    description: "Impressions from same period last year"

  - aliases:
      - "Estimated Missed Impressions Range Min"
    db_column: "estimated_missed_impressions_range_min"
    data_type: "integer"
    validation: ["non_negative", "allow_null"]
    description: "Minimum estimated missed impressions due to budget"

  - aliases:
      - "Estimated Missed Impressions Range Max"
    db_column: "estimated_missed_impressions_range_max"
    data_type: "integer"
    validation: ["non_negative", "allow_null"]
    description: "Maximum estimated missed impressions due to budget"

  - aliases:
      - "Clicks"
    db_column: "clicks"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of clicks on the ad"

  - aliases:
      - "Last Year Clicks"
    db_column: "last_year_clicks"
    data_type: "integer"
    validation: "allow_null"
    description: "Clicks from same period last year"

  - aliases:
      - "Estimated Missed Clicks Range Min"
    db_column: "estimated_missed_clicks_range_min"
    data_type: "integer"
    validation: ["non_negative", "allow_null"]
    description: "Minimum estimated missed clicks due to budget"

  - aliases:
      - "Estimated Missed Clicks Range Max"
    db_column: "estimated_missed_clicks_range_max"
    data_type: "integer"
    validation: ["non_negative", "allow_null"]
    description: "Maximum estimated missed clicks due to budget"

  - aliases:
      - "Click-Thru Rate (CTR)"
    db_column: "ctr"
    data_type: "percentage"
    validation: ["percentage", "allow_empty"]
    description: "Click-through rate percentage"

  - aliases:
      - "Spend"
    db_column: "spend"
    data_type: "currency"
    validation: "non_negative"
    description: "Total advertising spend"

  - aliases:
      - "Last Year Spend"
    db_column: "last_year_spend"
    data_type: "currency"
    validation: "allow_null"
    description: "Spend from same period last year"

  - aliases:
      - "Cost Per Click (CPC)"
    db_column: "cpc"
    data_type: "currency"
    validation: "allow_null"
    description: "Average cost per click"

  - aliases:
      - "Last Year Cost Per Click (CPC)"
    db_column: "last_year_cpc"
    data_type: "currency"
    validation: "allow_null"
    description: "Cost per click from same period last year"

  # Orders and Sales
  - aliases:
      - "7 Day Total Orders (#)"
    db_column: "seven_day_total_orders"
    data_type: "integer"
    validation: "allow_null"
    description: "Total orders attributed within 7 days"

  - aliases:
      - "Total Advertising Cost of Sales (ACOS)"
    db_column: "total_acos"
    data_type: "percentage"
    validation: "allow_null"
    description: "Advertising cost of sales percentage"

  - aliases:
      - "Total Return on Advertising Spend (ROAS)"
    db_column: "total_roas"
    data_type: "decimal"
    validation: "allow_null"
    description: "Return on advertising spend"

  - aliases:
      - "7 Day Total Sales"
    db_column: "seven_day_total_sales"
    data_type: "currency"
    validation: "allow_null"
    description: "Total sales attributed within 7 days"

  - aliases:
      - "Estimated Missed Sales Range Min"
    db_column: "estimated_missed_sales_range_min"
    data_type: "currency"
    validation: "allow_null"
    description: "Minimum estimated missed sales due to budget"

  - aliases:
      - "Estimated Missed Sales Range Max"
    db_column: "estimated_missed_sales_range_max"
    data_type: "currency"
    validation: "allow_null"
    description: "Maximum estimated missed sales due to budget"

