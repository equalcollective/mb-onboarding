# Detail Page Sales & Traffic Business Report Schema

report_type: "business_report"
display_name: "Detail Page Sales & Traffic Business Report"
description: "Amazon Business Report with sales and traffic metrics by ASIN"
allow_extra_columns: false  # Strict validation - no extra columns allowed

# Temporal configuration - defines how time periods are handled
temporal_config:
  model: "range"
  granularity_field: "period_granularity"
  supported_granularities: ["weekly", "monthly", "quarterly"]
  range_fields:
    start: "period_start_date"
    end: "period_end_date"

# Uniqueness definition - defines what makes a row unique for upsert operations
# Can include report columns, metadata columns, or both
uniqueness_keys:
  - "seller_id"       # Metadata column
  - "marketplace"     # Metadata column
  - "period_start_date"     # Metadata column (CHANGED from start_date)
  - "period_end_date"     # Metadata column (CHANGED from end_date)
  - "period_granularity"     # Metadata column (CHANGED from time_period)
  - "dashboard_views"     # Metadata column
  - "child_asin"      # Report column
  - "parent_asin"
  - "sku"

# Metadata fields that can be provided with the report
metadata_schema:
  required:
    - name: "report_date"
      data_type: "date"
      validation: "valid_date"
      description: "The date for which this report was generated"

    - name: "marketplace"
      data_type: "string"
      validation: "marketplace_enum"
      description: "The marketplace for this report (US or UK)"

    - name: "seller_id"
      data_type: "string"
      validation: "non_empty"
      description: "The seller ID for this report"

    - name: "period_granularity"
      data_type: "string"
      validation: "enum"
      allowed_values: ["weekly", "monthly", "quarterly"]
      description: "Time granularity for this report - 'weekly', 'monthly', or 'quarterly'"

    - name: "period_start_date"
      data_type: "date"
      validation: "valid_date"
      description: "Period start date"

    - name: "period_end_date"
      data_type: "date"
      validation: "valid_date"
      description: "Period end date"

    - name: "dashboard_views"
      data_type: "string"
      validation: "non_empty"
      default: "all columns"
      description: "Dashboard views - always 'all columns'"

  optional:
    - name: "asin_search"
      data_type: "string"
      validation: "allow_null"
      default: null
      description: "ASIN search - always null"
      disabled: true

# Upload validation checks - validates CSV content against existing data
upload_validation_checks:
  enabled: true
  applies_from_upload: 2  # Skip validation for first upload (no data to compare)

  intersection_checks:
    - column: "parent_asin"
      min_intersection_percent: 50
      check_type: "set_intersection"
      scope: "seller_marketplace"
      description: "Parent ASINs must have 50% overlap with existing data to prevent seller mismatch"

# All columns are required from Amazon's Business Report
# Each column uses 'aliases' list - first alias is canonical name
required_columns:
  # Product Identifiers
  - aliases:
      - "(Parent) ASIN"
    db_column: "parent_asin"
    data_type: "string"
    validation: "asin_format"
    description: "Parent product ASIN"

  - aliases:
      - "(Child) ASIN"
    db_column: "child_asin"
    data_type: "string"
    validation: "asin_format"
    description: "Child/variant product ASIN"

  - aliases:
      - "Title"
    db_column: "product_title"
    data_type: "string"
    validation: "non_empty"
    description: "Product title/name"

  - aliases:
      - "SKU"
    db_column: "sku"
    data_type: "string"
    validation: "non_empty"
    description: "Seller's SKU for the product"

  # Traffic Metrics - Sessions
  - aliases:
      - "Sessions - Total"
    db_column: "sessions_total"
    data_type: "numeric_with_commas"
    validation: "non_negative"
    description: "Total number of sessions"

  - aliases:
      - "Sessions - Total - B2B"
    db_column: "sessions_b2b"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of B2B sessions"

  - aliases:
      - "Session Percentage - Total"
    db_column: "session_percentage_total"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of total sessions"

  - aliases:
      - "Session Percentage - Total - B2B"
    db_column: "session_percentage_b2b"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of B2B sessions"

  # Traffic Metrics - Page Views
  - aliases:
      - "Page Views - Total"
    db_column: "page_views_total"
    data_type: "numeric_with_commas"
    validation: "non_negative"
    description: "Total number of page views"

  - aliases:
      - "Page Views - Total - B2B"
    db_column: "page_views_b2b"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of B2B page views"

  - aliases:
      - "Page Views Percentage - Total"
    db_column: "page_views_percentage_total"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of total page views"

  - aliases:
      - "Page Views Percentage - Total - B2B"
    db_column: "page_views_percentage_b2b"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of B2B page views"

  # Buy Box Metrics
  - aliases:
      - "Featured Offer (Buy Box) Percentage"
    db_column: "buy_box_percentage"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of time product had the Buy Box"

  - aliases:
      - "Featured Offer (Buy Box) Percentage - B2B"
    db_column: "buy_box_percentage_b2b"
    data_type: "percentage"
    validation: "percentage"
    description: "Percentage of time product had the B2B Buy Box"

  # Sales Metrics - Units
  - aliases:
      - "Units Ordered"
    db_column: "units_ordered"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of units ordered"

  - aliases:
      - "Units Ordered - B2B"
    db_column: "units_ordered_b2b"
    data_type: "integer"
    validation: "non_negative"
    description: "Number of B2B units ordered"

  # Conversion Metrics
  - aliases:
      - "Unit Session Percentage"
    db_column: "unit_session_percentage"
    data_type: "percentage"
    validation: "percentage"
    description: "Conversion rate (units/sessions)"

  - aliases:
      - "Unit Session Percentage - B2B"
    db_column: "unit_session_percentage_b2b"
    data_type: "percentage"
    validation: "percentage"
    description: "B2B conversion rate"

  # Sales Metrics - Revenue
  - aliases:
      - "Ordered Product Sales"
    db_column: "ordered_product_sales"
    data_type: "currency"
    validation: "currency"
    description: "Total sales revenue in dollars"

  - aliases:
      - "Ordered Product Sales - B2B"
    db_column: "ordered_product_sales_b2b"
    data_type: "currency"
    validation: "currency"
    description: "B2B sales revenue in dollars"

  # Order Items
  - aliases:
      - "Total Order Items"
    db_column: "total_order_items"
    data_type: "integer"
    validation: "non_negative"
    description: "Total number of order items"

  - aliases:
      - "Total Order Items - B2B"
    db_column: "total_order_items_b2b"
    data_type: "integer"
    validation: "non_negative"
    description: "Total number of B2B order items"
